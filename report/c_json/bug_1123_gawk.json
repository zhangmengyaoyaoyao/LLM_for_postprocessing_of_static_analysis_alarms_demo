{
    "project": "gawk",
    "tool": "Infer",
    "category": "NULL_DEREFERENCE",
    "file": "debug.c",
    "message": "pointer `buf` last assigned on line 421 could be null and is dereferenced by call to `read()` at line 427, column 14.",
    "warning_function_name": "find_lines",
    "warning_line": "while ((n = read(s->fd, buf, s->bufsize)) > 0) {",
    "warning_context": "static int\nfind_lines(SRCFILE *s)\n{\n\tchar *buf, *p, *end;\n\tint n;\n\tint ofs = 0;\n\tint *pos;\n\tint pos_size;\n\tint maxlen = 0;\n\tint numlines = 0;\n\tchar lastchar = '\\0';\n\n\temalloc(buf, char *, s->bufsize, \"find_lines\");\n\tpos_size = s->srclines;\n\temalloc(s->line_offset, int *, (pos_size + 2) * sizeof(int), \"find_lines\");\n\tpos = s->line_offset;\n\tpos[0] = 0;\n\n\twhile ((n = read(s->fd, buf, s->bufsize)) > 0) {\n\t\tend = buf + n;\n\t\tlastchar = buf[n - 1];\n\t\tp = buf;\n\t\twhile (p < end) {\n\t\t\tif (*p++ == '\\n') {\n\t\t\t\tif (++numlines > pos_size) {\n\t\t\t\t\terealloc(s->line_offset, int *, (2 * pos_size + 2) * sizeof(int), \"find_lines\");\n\t\t\t\t\tpos = s->line_offset + pos_size;\n\t\t\t\t\tpos_size *= 2;\n\t\t\t\t}\n\t\t\t\t*++pos = ofs + (p - buf);\n\t\t\t\tif ((pos[0] - pos[-1]) > maxlen)\n\t\t\t\t\tmaxlen = pos[0] - pos[-1];\t/* length including NEWLINE */\n\t\t\t}\n\t\t}\n\t\tofs += n;\n\t}\n\tefree(buf);\n\n\tif (n == -1) {\n\t\td_error(_(\"can't read source file `%s' (%s)\"),\n\t\t\t\t\ts->src, strerror(errno));\n\t\treturn -1;\n\t}\n\tif (ofs <= 0) {\n\t\tfprintf(out_fp, _(\"source file `%s' is empty.\\n\"), s->src);\n\t\treturn -1;\n\t}\n\n\tif (lastchar != '\\n') {\n\t\t/* fake a NEWLINE at end */\n\t\t*++pos = ofs + 1;\n\t\tnumlines++;\n\t\tif ((pos[0] - pos[-1]) > maxlen)\n\t\t\tmaxlen = pos[0] - pos[-1];\n\t}\n\ts->maxlen = maxlen;\n\ts->srclines = numlines;\n\treturn 0;\n}\n"
}
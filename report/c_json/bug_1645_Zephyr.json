{
    "project": "Zephyr",
    "tool": "Cppcheck",
    "category": "Null Pointer Dereference",
    "file": "subsys/net/ip/tcp2.c",
    "message": "Either the condition '!conn' is redundant or there is possible null pointer dereference: conn.",
    "warning_function_name": "net_tcp_accept",
    "warning_line": "conn->accept_cb = cb;",
    "warning_context": "int net_tcp_accept(struct net_context *context, net_tcp_accept_cb_t cb,\n\t\t   void *user_data)\n{\n\tstruct tcp *conn = context->tcp;\n\tstruct sockaddr local_addr = { };\n\tu16_t local_port, remote_port;\n\n\tNET_DBG(\"context: %p, tcp: %p, cb: %p\", context, conn, cb);\n\n\tconn->accept_cb = cb;\n\n\tif (!conn || conn->state != TCP_LISTEN) {\n\t\treturn -EINVAL;\n\t}\n\n\tlocal_addr.sa_family = net_context_get_family(context);\n\n\tswitch (local_addr.sa_family) {\n\t\tstruct sockaddr_in *in;\n\t\tstruct sockaddr_in6 *in6;\n\n\tcase AF_INET:\n\t\tin = (struct sockaddr_in *)&local_addr;\n\n\t\tif (net_sin_ptr(&context->local)->sin_addr) {\n\t\t\tnet_ipaddr_copy(&in->sin_addr,\n\t\t\t\t\tnet_sin_ptr(&context->local)->sin_addr);\n\t\t}\n\n\t\tin->sin_port =\n\t\t\tnet_sin((struct sockaddr *)&context->local)->sin_port;\n\t\tlocal_port = ntohs(in->sin_port);\n\t\tremote_port = ntohs(net_sin(&context->remote)->sin_port);\n\n\t\tbreak;\n\n\tcase AF_INET6:\n\t\tin6 = (struct sockaddr_in6 *)&local_addr;\n\n\t\tif (net_sin6_ptr(&context->local)->sin6_addr) {\n\t\t\tnet_ipaddr_copy(&in6->sin6_addr,\n\t\t\t\tnet_sin6_ptr(&context->local)->sin6_addr);\n\t\t}\n\n\t\tin6->sin6_port =\n\t\t\tnet_sin6((struct sockaddr *)&context->local)->sin6_port;\n\t\tlocal_port = ntohs(in6->sin6_port);\n\t\tremote_port = ntohs(net_sin6(&context->remote)->sin6_port);\n\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tcontext->user_data = user_data;\n\n\treturn net_conn_register(net_context_get_ip_proto(context),\n\t\t\t\t local_addr.sa_family,\n\t\t\t\t context->flags & NET_CONTEXT_REMOTE_ADDR_SET ?\n\t\t\t\t &context->remote : NULL,\n\t\t\t\t &local_addr,\n\t\t\t\t remote_port, local_port,\n\t\t\t\t tcp_pkt_received, context,\n\t\t\t\t &context->conn_handler);\n}\n"
}
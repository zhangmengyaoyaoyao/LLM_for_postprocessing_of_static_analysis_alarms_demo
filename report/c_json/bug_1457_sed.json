{
    "Project": "sed",
    "Tool": "Cppcheck",
    "category": "memleakOnRealloc",
    "file": "testsuite/tst-pcre.c",
    "message": "Common realloc mistake: 'pattern' nulled but not freed upon failure",
    "warning_function_name": "main",
    "warning_line": "pattern = realloc (pattern, p - line);",
    "warning_context": "  int ignorecase = 0;\n  int pattern_valid = 0, rm_valid = 0;\n  size_t linenum;\n\n#ifdef HAVE_MCHECK_H\n  mtrace ();\n#endif\n\n  if (argc < 2)\n    {\n      fprintf (stderr, \"Missing test filename\\n\");\n      return 1;\n    }\n\n  f = fopen (argv[1], \"r\");\n  if (f == NULL)\n    {\n      fprintf (stderr, \"Couldn't open %s\\n\", argv[1]);\n      return 1;\n    }\n\n  if ((len = getline (&line, &line_len, f)) <= 0\n      || strncmp (line, \"# PCRE\", 6) != 0)\n    {\n      fprintf (stderr, \"Not a PCRE test file\\n\");\n      fclose (f);\n      free (line);\n      return 1;\n    }\n\n  linenum = 1;\n\n  while ((len = getline (&line, &line_len, f)) > 0)\n    {\n      char *p;\n      unsigned long num;\n\n      ++linenum;\n\n      if (line[len - 1] == '\\n')\n\tline[--len] = '\\0';\n\n      if (line[0] == '#')\n\tcontinue;\n\n      if (line[0] == '\\0')\n\t{\n\t  /* End of test.  */\n\t  ignorecase = 0;\n\t  pattern_valid = 0;\n\t  rm_valid = 0;\n\t  continue;\n\t}\n\n      if (line[0] == '/')\n\t{\n\t  /* Pattern.  */\n\t  p = strrchr (line + 1, '/');\n\n\t  pattern_valid = 0;\n\t  rm_valid = 0;\n\t  if (p == NULL)\n\t    {\n\t      printf (\"%lu: Invalid pattern line: %s\\n\", linenum, line);\n\t      ret = 1;\n\t      continue;\n\t    }\n\n\t  if (p[1] == 'i' && p[2] == '\\0')\n\t    ignorecase = 1;\n\t  else if (p[1] != '\\0')\n\t    {\n\t      printf (\"%lu: Invalid pattern line: %s\\n\", linenum, line);\n\t      ret = 1;\n\t      continue;\n\t    }\n\n\t  if (pattern_alloced < (size_t) (p - line))\n\t    {\n\t      pattern = realloc (pattern, p - line);\n\t      if (pattern == NULL)\n\t\t{\n\t\t  printf (\"%lu: Cannot record pattern: %m\\n\", linenum);\n\t\t  ret = 1;\n\t\t  break;\n\t\t}\n\t      pattern_alloced = p - line;\n\t    }\n\n\t  memcpy (pattern, line + 1, p - line - 1);\n\t  pattern[p - line - 1] = '\\0';\n\t  pattern_valid = 1;\n\t  continue;\n\t}\n\n      if (strncmp (line, \"    \", 4) == 0)\n\t{\n\t  regex_t re;\n\t  int n;\n    \n\t  if (!pattern_valid)\n"
}
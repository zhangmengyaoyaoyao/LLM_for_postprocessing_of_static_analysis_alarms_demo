{
    "Project": "gawk",
    "Tool": "Infer",
    "Bug Type": "NULL_DEREFERENCE",
    "Message": "pointer `buf` last assigned on line 4207 could be null and is dereferenced at line 4222, column 8.",
    "Code_line": "\t\t\tif (buf[bl-1] != '\\n') /* buffer output until see a newline at end */",
    "Code_function": "gprintf(FILE *fp, const char *format, ...)\n{\n\tva_list args;\n\tstatic char *buf = NULL;\n\tstatic size_t buflen = 0;\n\tstatic int bl = 0;\n\tchar *p, *q;\n\tint nchar;\n\n#define GPRINTF_BUFSIZ 512\n\tif (buf == NULL) {\n\t\tbuflen = GPRINTF_BUFSIZ;\n\t\temalloc(buf, char *, (buflen + 2) * sizeof(char), \"gprintf\");\n\t} else if (buflen - bl < GPRINTF_BUFSIZ/2) {\n\t\tbuflen += GPRINTF_BUFSIZ;\n\t\terealloc(buf, char *, (buflen + 2) * sizeof(char), \"gprintf\");\n\t}\n#undef GPRINTF_BUFSIZ\n\n\twhile (true) {\n\t\tva_start(args, format);\n\t\tnchar = vsnprintf(buf + bl, buflen - bl, format, args);\n\t\tva_end(args);\n\t\tif (nchar == 0)\n\t\t\treturn 0;\n\t\tif (nchar > 0 && nchar < buflen - bl) {\n\t\t\tbl += nchar;\n\t\t\tif (buf[bl-1] != '\\n') /* buffer output until see a newline at end */\n\t\t\t\treturn nchar;\n\t\t\tbreak;\n\t\t}\n\n\t\t/* enlarge buffer, and try again */\n\t\tbuflen *= 2;\n\t\terealloc(buf, char *, (buflen + 2) * sizeof(char), \"gprintf\");\n\t}\n\n\tbl = 0;\n\tfor (p = buf; (q = strchr(p, '\\n')) != NULL; p = q + 1) {\n\t\tint sz = (int) (q - p);\n\n\t\twhile (sz > 0) {\n\t\t\tint cnt;\n\t\t\tcnt = sz > screen_width ? screen_width : sz;\n\n\t\t\t/* do not print partial line before scrolling */\n\t\t\tif (cnt < sz && (pager_lines_printed == (screen_height - 2)))\n\t\t\t\tprompt_continue(fp);\n\n\t\t\tif (fwrite(p, sizeof(char), cnt, fp) != cnt)\n\t\t\t\treturn -1;\n\t\t\tif (cnt == sz)\n\t\t\t\tbreak;\n\t\t\telse {\n\t\t\t\tif (++pager_lines_printed == (screen_height - 1))\n\t\t\t\t\tprompt_continue(fp);\n\t\t\t\tsz -= screen_width;\n\t\t\t\tassert(sz > 0);\n\t\t\t\tp += cnt;\n\t\t\t}\n\t\t}\n\n\t\tfprintf(fp, \"\\n\");\n\t\tif (++pager_lines_printed == (screen_height - 1))\n\t\t\tprompt_continue(fp);\n\t\tp++;\n\t}\n\treturn nchar;\n}"
}
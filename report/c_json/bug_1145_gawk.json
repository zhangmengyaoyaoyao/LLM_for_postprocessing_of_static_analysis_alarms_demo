{
    "project": "gawk",
    "tool": "Infer",
    "category": "BUFFER_OVERRUN_L3",
    "file": "extension/filefuncs.c",
    "message": "Offset added: [1, +oo] Size: [0, +oo] by call to `gawk_fts_read`.",
    "warning_function_name": "process",
    "warning_line": "while ((fentry = fts_read(heirarchy)) != NULL) {",
    "warning_context": "static void\nprocess(FTS *heirarchy, awk_array_t destarray, int seedot)\n{\n\tFTSENT *fentry;\n\tawk_value_t index, value;\n\tawk_array_t element_array, newdir_array, dot_array;\n\tawk_bool_t bad_ret = awk_false;\n\n\t/* path is full path,  pathlen is length thereof */\n\t/* name is name in directory, namelen is length thereof */\n\twhile ((fentry = fts_read(heirarchy)) != NULL) {\n\t\tbad_ret = awk_false;\n\n\t\tswitch (fentry->fts_info) {\n\t\tcase FTS_D:\n\t\t\t/* directory */\n\t\t\t/* create array to hold entries */\n\t\t\tnewdir_array = create_array();\n\t\t\tif (newdir_array == NULL) {\n\t\t\t\twarning(ext_id, _(\"fts-process: could not create array\"));\n\t\t\t\tfts_errors++;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t/* store new directory in its parent directory */\n\t\t\t(void) make_const_string(fentry->fts_name, fentry->fts_namelen, & index);\n\t\t\tvalue.val_type = AWK_ARRAY;\n\t\t\tvalue.array_cookie = newdir_array;\n\t\t\tif (! set_array_element(destarray, & index, & value)) {\n\t\t\t\twarning(ext_id, _(\"fts-process: could not set element\"));\n\t\t\t\tfts_errors++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tnewdir_array = value.array_cookie;\n\n\t\t\t/* push current directory */\n\t\t\tstack_push(destarray);\n\n\t\t\t/* new directory becomes current */\n\t\t\tdestarray = newdir_array;\n\t\t\tbreak;\n\n\t\tcase FTS_DNR:\n\t\tcase FTS_DC:\n\t\tcase FTS_ERR:\n\t\tcase FTS_NS:\n\t\t\t/* error */\n\t\t\tbad_ret = awk_true;\n\t\t\t/* fall through */\n\n\t\tcase FTS_NSOK:\n\t\tcase FTS_SL:\n\t\tcase FTS_SLNONE:\n\t\tcase FTS_F:\n\t\tcase FTS_DOT:\n\t\t\t/* if see dot, skip \".\" */\n\t\t\tif (seedot && strcmp(fentry->fts_name, \".\") == 0)\n\t\t\t\tbreak;\n\n\t\t\t/*\n\t\t\t * File case.\n\t\t\t * destarray is the directory we're reading.\n\t\t\t * step 1: create new empty array\n\t\t\t */\n\t\t\telement_array = create_array();\n\t\t\tif (element_array == NULL) {\n\t\t\t\twarning(ext_id, _(\"fts-process: could not create array\"));\n\t\t\t\tfts_errors++;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t/* step 2: add element array to parent array */\n\t\t\t(void) make_const_string(fentry->fts_name, fentry->fts_namelen, & index);\n\t\t\tvalue.val_type = AWK_ARRAY;\n\t\t\tvalue.array_cookie = element_array;\n\t\t\tif (! set_array_element(destarray, & index, & value)) {\n\t\t\t\twarning(ext_id, _(\"fts-process: could not set element\"));\n\t\t\t\tfts_errors++;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t/* step 3: fill in path, stat, error elements */\n\t\t\tfill_default_elements(element_array, fentry, bad_ret);\n\t\t\tbreak;\n\n\t\tcase FTS_DP:\n\t\t\t/* create \".\" subarray */\n\t\t\tdot_array = create_array();\n\n\t\t\t/* add it to parent */\n\t\t\t(void) make_const_string(\".\", 1, & index);\n\t\t\tvalue.val_type = AWK_ARRAY;\n\t\t\tvalue.array_cookie = dot_array;\n\t\t\tif (! set_array_element(destarray, & index, & value)) {\n\t\t\t\twarning(ext_id, _(\"fts-process: could not set element\"));\n\t\t\t\tfts_errors++;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t/* fill it in with path, stat, error elements */\n\t\t\tfill_default_elements(dot_array, fentry, bad_ret);\n"
}